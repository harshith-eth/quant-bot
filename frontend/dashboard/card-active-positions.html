<h2 style="font-weight: normal;">ACTIVE POSITIONS
    <span style="float: right; font-size: 0.9em; font-family: 'Courier New', monospace; color: #00ff00; font-weight: normal;">
        <span id="position-count">0/5</span>
    </span>
</h2>
<div class="trade-list">
    <div class="trade-header">
        <div class="trade-item">
            <div class="token-cell">Token</div>
            <div class="mc-cell">MC</div>
            <div class="entry-cell">Entry</div>
            <div class="size-cell">Size</div>
            <div class="pl-cell">P/L</div>
            <div class="time-cell">Time</div>
            <div class="action-cell">TP</div>
        </div>
    </div>
    <div class="trade-scrollable">
        <div id="active-trades">
            <!-- Positions will be loaded dynamically from API -->
            <div id="loading-positions" class="trade-item" style="text-align: center; color: #00ff00; padding: 20px;">
                ü§ñ LOADING REAL POSITIONS...
            </div>
        </div>
    </div>
</div>

<style>
#active-positions.card {
    padding: 0 !important;
    margin: 0 !important;
    position: relative !important;
    height: 44vh !important;
    overflow: hidden !important;
}

#active-positions h2 {
    padding: 1vh;
    margin: 0 !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 3 !important;
}

.trade-list {
    position: absolute !important;
    top: 4vh !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
}

.trade-header {
    position: sticky;
    top: 0;
    background: #000000;
    z-index: 2;
    border-bottom: 1px solid #003300;
    padding: 0 1vh;
}

.trade-scrollable {
    position: absolute !important;
    top: 3vh !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    overflow-y: auto;
    -ms-overflow-style: none;
    scrollbar-width: none;
}

.trade-scrollable::-webkit-scrollbar {
    display: none !important;
}

.trade-item {
    display: grid;
    grid-template-columns: 1.2fr 0.8fr 1.5fr 1fr 1fr 0.8fr 0.8fr;
    gap: 10px;
    align-items: center;
    padding: 4px 8px;
    min-height: 32px;
}

.trade-header .trade-item {
    font-weight: bold;
    padding: 2px 8px;
    min-height: 24px;
}

.token-cell { 
    grid-column: 1; 
    font-size: 1.24vh;
    padding-left: 0;
}
.mc-cell { 
    grid-column: 2; 
    text-align: right; 
    font-size: 1.24vh;
    padding-right: 2px;
}
.entry-cell { 
    grid-column: 3; 
    text-align: right; 
    font-size: 1.24vh;
    padding-right: 2px;
}
.size-cell { 
    grid-column: 4; 
    text-align: right; 
    font-size: 1.24vh;
    padding-right: 2px;
}
.pl-cell { 
    grid-column: 5; 
    text-align: right; 
    font-size: 1.24vh;
    padding-right: 2px;
}
.time-cell { 
    grid-column: 6; 
    text-align: center; 
    font-size: 1.24vh;
}
.action-cell { 
    grid-column: 7; 
    font-size: 1.24vh;
    text-align: left;
    padding-left: 4px;
}

.trade-header .token-cell { padding-left: 0; }
.trade-header .mc-cell { padding-right: 2px; }
.trade-header .entry-cell { padding-right: 2px; }
.trade-header .size-cell { padding-right: 2px; }
.trade-header .pl-cell { padding-right: 2px; }
.trade-header .time-cell { text-align: center; }
.trade-header .action-cell { padding-left: 4px; }

.token-name {
    display: block;
    text-shadow: none;
    font-weight: normal;
    font-size: 1.24vh;
}
</style>

<script>
// Fetch and display real active positions
async function loadActivePositions() {
    try {
        const response = await fetch('/api/active-positions');
        const data = await response.json();
        
        // Update position count
        document.getElementById('position-count').textContent = data.active_count || '0/5';
        
        // Clear loading message
        const tradesContainer = document.getElementById('active-trades');
        tradesContainer.innerHTML = '';
        
        // Display positions or empty state
        if (data.positions && data.positions.length > 0) {
            data.positions.forEach(position => {
                const tradeItem = document.createElement('div');
                tradeItem.className = 'trade-item active-trade';
                
                const profitClass = position.profit_class === 'profit' ? 'profit' : 'loss';
                
                tradeItem.innerHTML = `
                    <div class="token-cell"><span class="token-name">${position.token}</span></div>
                    <div class="mc-cell">${position.market_cap}</div>
                    <div class="entry-cell">${position.entry_price}</div>
                    <div class="size-cell">${position.size}</div>
                    <div class="${profitClass} pl-cell">${position.pl_percent}</div>
                    <div class="time-cell"><span class="time-elapsed" style="font-size: 1.24vh;">${position.time_elapsed}</span></div>
                    <div class="action-cell" style="text-align: left; display: flex; justify-content: flex-start; padding-left: 0;">
                        <button class="action-btn ${getButtonClass(position.action_button)}" 
                                style="background: ${getButtonBackground(position.action_button)}; border: 1px solid ${getButtonBorder(position.action_button)}; color: ${getButtonColor(position.action_button)}; padding: 0.3vh 1vh; cursor: pointer; font-size: 1.24vh; text-shadow: 0 0 3px ${getButtonShadow(position.action_button)};">
                            ${position.action_button}
                        </button>
                    </div>
                `;
                
                tradesContainer.appendChild(tradeItem);
            });
        } else {
            // Show empty state
            tradesContainer.innerHTML = `
                <div class="trade-item" style="text-align: center; color: #888; padding: 40px;">
                    üéØ NO ACTIVE POSITIONS<br>
                    <span style="font-size: 0.9em;">AI SCANNING FOR OPPORTUNITIES...</span>
                </div>
            `;
        }
        
    } catch (error) {
        console.error('Error loading positions:', error);
        document.getElementById('active-trades').innerHTML = `
            <div class="trade-item" style="text-align: center; color: #ff0000; padding: 20px;">
                ‚ùå ERROR LOADING POSITIONS
            </div>
        `;
    }
}

function getButtonClass(action) {
    switch(action) {
        case 'TP1':
        case 'TP2':
            return 'tp-ready';
        default:
            return 'monitoring';
    }
}

function getButtonBackground(action) {
    return '#001100';
}

function getButtonBorder(action) {
    switch(action) {
        case 'TP1':
        case 'TP2':
            return '#003300';
        default:
            return '#332200';
    }
}

function getButtonColor(action) {
    switch(action) {
        case 'TP1':
        case 'TP2':
            return '#00ff00';
        default:
            return '#ffff00';
    }
}

function getButtonShadow(action) {
    switch(action) {
        case 'TP1':
        case 'TP2':
            return 'rgba(0, 255, 0, 0.5)';
        default:
            return 'rgba(255, 255, 0, 0.5)';
    }
}

// Load positions on page load
document.addEventListener('DOMContentLoaded', loadActivePositions);

// Auto-refresh every 5 seconds
setInterval(loadActivePositions, 5000);
</script>
