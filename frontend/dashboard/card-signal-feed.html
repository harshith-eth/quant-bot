<h2 style="font-weight: normal;">SIGNAL FEED
    <span style="float: right; font-size: 0.9em; font-family: 'Courier New', monospace; color: #00ff00; font-weight: normal;">
        24H: 2.4K » ACC: 92.4% » ALERTS: 18
    </span>
</h2>

<div class="signal-content">
    <div class="signal-grid">
        <!-- Market Scanner Section -->
        <div class="signal-section">
            <div class="metric-title">Market Scanner</div>
            <div class="signal-feed" id="market-feed">
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:32:45</span>] » $MOONBURN DETECTED
                    <br>• MC: $120K | LP: $25K
                    <br>• B/S Ratio: 5.2:1
                    <br>• Contract: ✅ SAFU
                </div>
                <div class="signal-entry alert">
                    [<span class="timestamp">11:31:30</span>] » $PEPENOMICS LAUNCH
                    <br>• MC: $85K | LP: $15K
                    <br>• Holders: 125 | Tax: 3/3
                    <br>• Risk Level: MEDIUM
                </div>
                <div class="signal-entry">
                    [<span class="timestamp">11:30:15</span>] » MARKET UPDATE
                    <br>• New Listings: 12
                    <br>• Trending: $WOJAK, $PEPE
                    <br>• Volume 24h: $2.5M
                </div>
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:29:00</span>] » $SHIBAI DETECTED
                    <br>• MC: $250K | LP: $50K
                    <br>• B/S Ratio: 4.8:1
                    <br>• AI Token Potential: HIGH
                </div>
            </div>
        </div>

        <!-- Whale Activity Section -->
        <div class="signal-section">
            <div class="metric-title">Whale Tracker</div>
            <div class="signal-feed" id="whale-feed">
                <div class="signal-entry alert">
                    [<span class="timestamp">11:31:23</span>] » WALLET: 3J87XYZ
                    <br>• Size: 150 SOL ($5000)
                    <br>• Token: $MOONBURN (12%)
                </div>
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:30:45</span>] » WHALE ACCUMULATION
                    <br>• 3 Wallets > 500 SOL
                    <br>• Target: $PEPENOMICS
                    <br>• Pattern: BULLISH
                </div>
                <div class="signal-entry">
                    [<span class="timestamp">11:29:30</span>] » WALLET: KL92PQR
                    <br>• History: 85% Win Rate
                    <br>• Tracking: 5 New Tokens
                    <br>• Focus: AI/MEME Hybrid
                </div>
                <div class="signal-entry alert">
                    [<span class="timestamp">11:28:15</span>] » SMART MONEY
                    <br>• Moving: $25K → $SHIBAI
                    <br>• Multiple Wallets: 8
                    <br>• Previous Success: 92%
                </div>
            </div>
        </div>

        <!-- Social Signals Section -->
        <div class="signal-section">
            <div class="metric-title">Social Signals</div>
            <div class="signal-feed" id="social-feed">
                <div class="signal-entry">
                    [<span class="timestamp">11:33:10</span>] » $FROGO
                    <br>• Twitter: 8,950 (+250%)
                    <br>• Sentiment: 78% BULLISH
                </div>
                <div class="signal-entry alert">
                    [<span class="timestamp">11:32:00</span>] » $MOONBURN
                    <br>• TG Members: +2500 (15min)
                    <br>• Twitter Trend Score: 89
                    <br>• Influencer Alert: 3 MAJOR
                </div>
                <div class="signal-entry">
                    [<span class="timestamp">11:30:45</span>] » $SHIBAI
                    <br>• Reddit Mentions: 1.2K
                    <br>• Discord Activity: HIGH
                    <br>• Community Growth: +180%
                </div>
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:29:30</span>] » VIRAL ALERT
                    <br>• Token: $PEPENOMICS
                    <br>• Platform: Twitter/TG
                    <br>• Virality Score: 92/100
                </div>
            </div>
        </div>

        <!-- Trade Signals Section -->
        <div class="signal-section">
            <div class="metric-title">Trade Signals</div>
            <div class="signal-feed" id="trade-feed">
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:40:03</span>] » SL HIT
                    <br>• $ZOOMPEPE: -30%
                    <br>• Balance: $18.50
                </div>
                <div class="signal-entry alert">
                    [<span class="timestamp">11:39:15</span>] » ENTRY SIGNAL
                    <br>• Token: $MOONBURN
                    <br>• Amount: $5 (20% Capital)
                    <br>• Target: +150% (2.5x)
                </div>
                <div class="signal-entry">
                    [<span class="timestamp">11:38:00</span>] » POSITION UPDATE
                    <br>• $SHIBAI: +85%
                    <br>• Set TP: 150%
                    <br>• Trail SL: 15%
                </div>
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:37:30</span>] » TAKE PROFIT
                    <br>• $PEPENOMICS: +120%
                    <br>• Profit: $12.50
                    <br>• Remaining: 40% Position
                </div>
            </div>
        </div>

        <!-- Launch Detector Section -->
        <div class="signal-section">
            <div class="metric-title">Launch Detector</div>
            <div class="signal-feed" id="launch-feed">
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:42:10</span>] » NEW LAUNCH
                    <br>• Token: $SOLAPEPE
                    <br>• Initial LP: $10K
                    <br>• Time: 2m ago
                </div>
                <div class="signal-entry alert">
                    [<span class="timestamp">11:41:05</span>] » LIQUIDITY ADDED
                    <br>• Token: $WOJAK
                    <br>• Amount: 25 SOL
                    <br>• Buyers: 45
                </div>
                <div class="signal-entry">
                    [<span class="timestamp">11:40:30</span>] » CONTRACT DEPLOYED
                    <br>• Address: sol...4x2
                    <br>• Creator: Known Dev
                    <br>• Pattern: STANDARD
                </div>
            </div>
        </div>

        <!-- Rug Detector Section -->
        <div class="signal-section">
            <div class="metric-title">Rug Detector</div>
            <div class="signal-feed" id="rug-feed">
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:42:30</span>] » RUG ALERT
                    <br>• Token: $RUGCOIN
                    <br>• LP UNLOCKED ⚠️
                    <br>• Rug Score: 85/100
                </div>
                <div class="signal-entry alert">
                    [<span class="timestamp">11:41:45</span>] » SAFU CHECK
                    <br>• Token: $MOONBURN
                    <br>• LP LOCKED ✅
                    <br>• Safety: 92/100
                </div>
                <div class="signal-entry">
                    [<span class="timestamp">11:41:00</span>] » WALLET CHECK
                    <br>• Dev Wallet: 3.2%
                    <br>• Hidden Wallets: NONE
                    <br>• Honeypot Risk: LOW
                </div>
            </div>
        </div>

        <!-- Volume Analyzer Section -->
        <div class="signal-section">
            <div class="metric-title">Volume Analyzer</div>
            <div class="signal-feed" id="volume-feed">
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:43:15</span>] » VOLUME SPIKE
                    <br>• $MOONBURN: +500%
                    <br>• Buy/Sell: 8:1
                    <br>• Liquidity: DEEP
                </div>
                <div class="signal-entry alert">
                    [<span class="timestamp">11:42:30</span>] » ACCUMULATION
                    <br>• Token: $PEPENOMICS
                    <br>• 5m Volume: $50K
                    <br>• Pattern: BULLISH
                </div>
                <div class="signal-entry">
                    [<span class="timestamp">11:41:45</span>] » DEPTH CHECK
                    <br>• Buy Wall: 25 SOL
                    <br>• Sell Impact: 2.5%
                    <br>• Liquidity: HEALTHY
                </div>
            </div>
        </div>

        <!-- Momentum Scanner Section -->
        <div class="signal-section">
            <div class="metric-title">Momentum Scanner</div>
            <div class="signal-feed" id="momentum-feed">
                <div class="signal-entry emergency">
                    [<span class="timestamp">11:43:30</span>] » BREAKOUT
                    <br>• $WOJAK: +120% 5m
                    <br>• Momentum: STRONG
                    <br>• FOMO Score: 85/100
                </div>
                <div class="signal-entry alert">
                    [<span class="timestamp">11:42:45</span>] » TREND ALERT
                    <br>• Multiple Buys
                    <br>• Price: PARABOLIC
                    <br>• Velocity: HIGH
                </div>
                <div class="signal-entry">
                    [<span class="timestamp">11:42:00</span>] » MOMENTUM CHECK
                    <br>• Buy Pressure: 78%
                    <br>• Trend Strength: HIGH
                    <br>• Pattern: EARLY PUMP
                </div>
            </div>
        </div>
    </div>
</div>

<style>
#signal-feed.card {
    padding: 0 !important;
    margin: 0 !important;
    position: relative !important;
    height: 44vh !important;
    overflow: hidden !important;
    background: linear-gradient(180deg, #000300 0%, #001100 100%) !important;
    border: 1px solid #00ff00 !important;
}

#signal-feed h2 {
    padding: 0.5vh;
    margin: 0 !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 3 !important;
    background: linear-gradient(90deg, #001100 0%, #000300 100%);
    border-bottom: 1px solid #00ff00;
    font-family: 'Courier New', monospace;
}

.signal-content {
    position: absolute !important;
    top: 3vh !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    overflow-y: auto !important;
    padding: 0.5vh !important;
    background: rgba(0, 5, 0, 0.2);
    font-family: 'Courier New', monospace;
    -ms-overflow-style: none !important;  /* IE and Edge */
    scrollbar-width: none !important;     /* Firefox */
}

/* Hide scrollbar for Chrome, Safari and Opera */
.signal-content::-webkit-scrollbar,
.signal-feed::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
}

.signal-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    padding-top: 0.2vh;
}

.signal-section {
    display: flex;
    flex-direction: column;
    gap: 4px;
    background: rgba(0, 10, 0, 0.3);
    padding: 5px;
    border: 1px solid rgba(0, 255, 0, 0.1);
}

.metric-title {
    font-size: 1.24vh;
    padding: 0.2vh 0;
    color: #00ff00;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.signal-feed {
    height: 130px;
    overflow-y: auto;
    padding: 0;
    -ms-overflow-style: none !important;  /* IE and Edge */
    scrollbar-width: none !important;     /* Firefox */
}

.signal-entry {
    font-size: 1.24vh;
    margin-bottom: 3px;
    padding: 4px 6px;
    border-radius: 2px;
    background: rgba(0, 20, 0, 0.4);
    line-height: 1.4;
    color: #b3ffb3;
    position: relative;
    overflow: hidden;
}

.signal-entry.emergency {
    background: rgba(20, 0, 0, 0.4);
    color: #ffb3b3;
}

.signal-entry.alert {
    background: rgba(20, 20, 0, 0.4);
    color: #ffffb3;
}

.timestamp {
    color: #00ff00;
    font-weight: bold;
    font-size: 1.24vh;
}

.signal-entry.emergency .timestamp {
    color: #ff0000;
}

.signal-entry.alert .timestamp {
    color: #ffff00;
}

@keyframes newSignal {
    0% {
        transform: translateX(-20px);
        opacity: 0;
    }
    100% {
        transform: translateX(0);
        opacity: 1;
    }
}

.signal-entry {
    animation: newSignal 0.4s ease-out;
}

/* Ensure all scrollable elements have hidden scrollbars */
* {
    -ms-overflow-style: none !important;
    scrollbar-width: none !important;
}

*::-webkit-scrollbar {
    display: none !important;
    width: 0 !important;
}
</style>

<script>
// Fetch and display real signal feed data
async function loadSignalFeed(preloadedData = null) {
    try {
        let data;
        if (preloadedData) {
            // Use preloaded data from WebSocket
            data = preloadedData;
            console.log('Using preloaded signal feed data from WebSocket');
        } else {
            // Fetch from API
            const response = await fetch('/api/signal-feed');
            data = await response.json();
            console.log('Signal feed data loaded from API');
        }

        // Update header stats
        const headerStats = document.querySelector('h2 > span');
        if (headerStats && data.stats) {
            headerStats.textContent = `24H: ${data.stats.signals_24h || '2.4K'} » ACC: ${data.stats.accuracy || '92.4%'} » ALERTS: ${data.stats.active_alerts || '18'}`;
        }

        // Process signals by category
        if (data.signals) {
            // Clear existing signals or keep them if needed
            // Iterate through each signal category
            const categories = [
                'market', 'whale', 'social', 'trade', 
                'launch', 'rug', 'volume', 'momentum'
            ];
            
            categories.forEach(category => {
                if (data.signals[category] && data.signals[category].length > 0) {
                    const feed = document.getElementById(`${category}-feed`);
                    if (feed) {
                        // Option 1: Clear existing signals and add new ones
                        feed.innerHTML = '';
                        
                        // Add new signals in reverse order (newest first)
                        data.signals[category].forEach(signal => {
                            addSignalToSection(category, signal);
                        });
                    }
                }
            });
        }
        
    } catch (error) {
        console.error('Error loading signal feed data:', error);
        // Show error state if needed in each feed
        const categories = [
            'market', 'whale', 'social', 'trade', 
            'launch', 'rug', 'volume', 'momentum'
        ];
        
        categories.forEach(category => {
            const feed = document.getElementById(`${category}-feed`);
            if (feed) {
                feed.innerHTML = `
                    <div class="signal-entry">
                        [<span class="timestamp">ERROR</span>] » Failed to load signals
                    </div>
                `;
            }
        });
    }
}

// Function to add new signal to specific section
function addSignalToSection(section, signal) {
    const feed = document.getElementById(`${section}-feed`);
    if (!feed) return;
    
    const entry = document.createElement('div');
    entry.className = `signal-entry ${signal.type || 'normal'}`;
    entry.innerHTML = `[<span class="timestamp">${signal.timestamp || getCurrentTime()}</span>] » ${signal.message.replace(/\n/g, '<br>')}`;
    feed.insertBefore(entry, feed.firstChild);
    
    // Keep only last 5 signals per section
    while (feed.children.length > 5) {
        feed.removeChild(feed.lastChild);
    }

    // Auto-scroll to top
    feed.scrollTop = 0;
}

// Helper to get current time in HH:MM:SS format
function getCurrentTime() {
    const now = new Date();
    return now.toTimeString().split(' ')[0];
}

// Provide a fallback for WebSocket notifications
function handleWebSocketSignal(data) {
    if (data && data.category && data.signal) {
        addSignalToSection(data.category, data.signal);
    }
}

// Make function globally available
window.loadSignalFeed = loadSignalFeed;
window.handleWebSocketSignal = handleWebSocketSignal;

// Load signals on page ready
document.addEventListener('DOMContentLoaded', function() {
    loadSignalFeed();
    
    // Auto-refresh every 6 seconds
    setInterval(loadSignalFeed, 6000);
});
</script>
