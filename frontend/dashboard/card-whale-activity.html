<h2 style="font-weight: normal;">WHALE ACTIVITY
    <span style="float: right; font-size: 0.9em; font-family: 'Courier New', monospace; color: #00ff00; font-weight: normal;">
        25KVOL 47MOVES $PEPE2HOT
    </span></h2>
<div class="whale-container">
    <div class="whale-filters">
        <button class="filter-btn active">All</button>
        <button class="filter-btn">Buys</button>
        <button class="filter-btn">Sells</button>
        <button class="filter-btn">Transfers</button>
    </div>
    <div class="whale-list" id="whale-movements">
        <div class="whale-header">
            <div class="col wallet">Wallet</div>
            <div class="col action">Action</div>
            <div class="col amount">Amount</div>
            <div class="col impact">Impact</div>
        </div>
        <div class="whale-scrollable" id="whale-feed">
            <div class="whale-item buy">
                <div class="col wallet">0x7a2...3f9b</div>
                <div class="col action">Buy</div>
                <div class="col amount">1,250 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item transfer">
                <div class="col wallet">0x9c4...8e2d</div>
                <div class="col action">Transfer</div>
                <div class="col amount">890 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item sell">
                <div class="col wallet">0x3b5...7a1c</div>
                <div class="col action">Sell</div>
                <div class="col amount">2,100 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item buy">
                <div class="col wallet">0x4d8...2e5f</div>
                <div class="col action">Buy</div>
                <div class="col amount">750 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item transfer">
                <div class="col wallet">0x6f1...9c3a</div>
                <div class="col action">Transfer</div>
                <div class="col amount">1,500 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item buy">
                <div class="col wallet">0x8e2...4d1c</div>
                <div class="col action">Buy</div>
                <div class="col amount">3,200 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item sell">
                <div class="col wallet">0x5a7...1b8d</div>
                <div class="col action">Sell</div>
                <div class="col amount">950 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item transfer">
                <div class="col wallet">0x2c9...7f4e</div>
                <div class="col action">Transfer</div>
                <div class="col amount">1,800 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item buy">
                <div class="col wallet">0x1d5...6e3a</div>
                <div class="col action">Buy</div>
                <div class="col amount">670 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item sell">
                <div class="col wallet">0xaf3...9c2b</div>
                <div class="col action">Sell</div>
                <div class="col amount">4,500 SOL</div>
                <div class="col impact critical">Critical</div>
            </div>
            <div class="whale-item buy">
                <div class="col wallet">0x4b8...2d7c</div>
                <div class="col action">Buy</div>
                <div class="col amount">2,300 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item transfer">
                <div class="col wallet">0x9e1...5a4d</div>
                <div class="col action">Transfer</div>
                <div class="col amount">1,100 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item sell">
                <div class="col wallet">0x7d6...3f8e</div>
                <div class="col action">Sell</div>
                <div class="col amount">830 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item buy">
                <div class="col wallet">0x2a9...8c4b</div>
                <div class="col action">Buy</div>
                <div class="col amount">5,600 SOL</div>
                <div class="col impact critical">Critical</div>
            </div>
            <div class="whale-item transfer">
                <div class="col wallet">0xbc5...1e7d</div>
                <div class="col action">Transfer</div>
                <div class="col amount">920 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item sell">
                <div class="col wallet">0x6f8...4a2c</div>
                <div class="col action">Sell</div>
                <div class="col amount">1,750 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item buy">
                <div class="col wallet">0x3e7...9b5a</div>
                <div class="col action">Buy</div>
                <div class="col amount">2,800 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item transfer">
                <div class="col wallet">0x8d4...2c6e</div>
                <div class="col action">Transfer</div>
                <div class="col amount">1,300 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item sell">
                <div class="col wallet">0x5c2...7f3d</div>
                <div class="col action">Sell</div>
                <div class="col amount">3,900 SOL</div>
                <div class="col impact critical">Critical</div>
            </div>
            <div class="whale-item buy">
                <div class="col wallet">0x1a8...4e2b</div>
                <div class="col action">Buy</div>
                <div class="col amount">1,600 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item transfer">
                <div class="col wallet">0x9f5...3d7c</div>
                <div class="col action">Transfer</div>
                <div class="col amount">780 SOL</div>
                <div class="col impact medium">Medium</div>
            </div>
            <div class="whale-item sell">
                <div class="col wallet">0x4c7...8a5e</div>
                <div class="col action">Sell</div>
                <div class="col amount">2,500 SOL</div>
                <div class="col impact high">High</div>
            </div>
            <div class="whale-item buy">
                <div class="col wallet">0x7b3...6d1f</div>
                <div class="col action">Buy</div>
                <div class="col amount">4,200 SOL</div>
                <div class="col impact critical">Critical</div>
            </div>
            <div class="whale-item transfer">
                <div class="col wallet">0x2e6...9c4a</div>
                <div class="col action">Transfer</div>
                <div class="col amount">1,900 SOL</div>
                <div class="col impact high">High</div>
            </div>
        </div>
    </div>
    <div class="whale-metrics">
        <div class="metric-box">
            Buy Pressure: <span id="whale-buy-pressure">65%</span>
            <div class="pressure-bar">
                <div class="pressure-fill" id="buy-pressure-fill" style="width: 65%"></div>
            </div>
        </div>
        <div class="metric-box">
            Sell Pressure: <span id="whale-sell-pressure">35%</span>
            <div class="pressure-bar">
                <div class="pressure-fill" id="sell-pressure-fill" style="width: 35%"></div>
            </div>
        </div>
    </div>
</div>

<style>
.whale-container {
    height: 39.5vh;
    display: flex;
    flex-direction: column;
}

.card-title {
    font-size: 0.8rem;
    margin-bottom: 0.3rem;
}

.whale-filters {
    margin-bottom: 0.3rem;
}

.filter-btn {
    background: #001100;
    border: 1px solid #003300;
    color: #00ff00;
    padding: 0.3vh 1vh;
    cursor: pointer;
    font-size: 1.24vh;
    text-shadow: 0 0 2px rgba(0, 255, 0, 0.2);
    margin-right: 0.5vh;
    transition: all 0.2s ease;
}

.filter-btn:hover {
    background: #001500;
    border-color: #004400;
    text-shadow: 0 0 2px rgba(0, 255, 0, 0.3);
}

.filter-btn.active {
    background: #001800;
    border-color: #005500;
    text-shadow: 0 0 2px rgba(0, 255, 0, 0.4);
}

.whale-header, .whale-item {
    display: grid;
    grid-template-columns: 30% 20% 25% 25%;
    gap: 4px;
    padding: 4px 6px;
    align-items: center;
}

.whale-header {
    font-size: 0.65rem;
    font-weight: 500;
    color: #00ff00;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.whale-list {
    flex: 1;
    overflow: hidden;
    min-height: 0;
}

.whale-item {
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    font-size: 0.7rem;
}

.col {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.col.wallet {
    color: #00ff00;
    opacity: 1;
}

.col.action {
    text-align: center;
}

.col.amount {
    text-align: right;
    padding-right: 8px;
}

.col.impact {
    text-align: center;
}

.whale-item.buy {
    background: rgba(0, 255, 0, 0.02);
}

.whale-item.buy .action {
    color: #00ff00;
}

.whale-item.sell {
    background: rgba(255, 0, 0, 0.02);
}

.whale-item.sell .action {
    color: #ff0000;
}

.whale-item.transfer {
    background: rgba(0, 150, 255, 0.02);
}

.whale-item.transfer .action {
    color: #ffff00;
}

.impact {
    padding: 1px 4px;
    border-radius: 2px;
    font-size: 0.6rem;
    display: inline-block;
    min-width: 45px;
}

.impact.low {
    background: rgba(255, 255, 0, 0.1);
    color: #ffff00;
}

.impact.medium {
    background: rgba(255, 165, 0, 0.1);
    color: #ffff00;
}

.impact.high {
    background: rgba(255, 0, 0, 0.1);
    color: #ff0000;
}

.impact.critical {
    background: rgba(255, 0, 0, 0.15);
    color: #ff0000;
    font-weight: 500;
}

.whale-scrollable {
    height: calc(100% - 30px);
    overflow-y: auto;
}

.whale-metrics {
    font-size: 0.7rem;
    padding: 4px 0;
    margin-top: auto;
    border-top: 1px solid rgba(0, 255, 0, 0.1);
}

.metric-box {
    margin-bottom: 0.2rem;
}

.pressure-bar {
    height: 3px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    margin-top: 2px;
}

.pressure-fill {
    height: 100%;
    transition: width 0.3s ease;
    border-radius: 2px;
}

#buy-pressure-fill {
    background: linear-gradient(90deg, #4CAF50, #8BC34A);
}

#sell-pressure-fill {
    background: linear-gradient(90deg, #FF5722, #F44336);
}
</style>

<script>
// Fetch and display real whale activity
async function loadWhaleActivity(preloadedData = null) {
    try {
        let data;
        if (preloadedData) {
            // Use preloaded data from WebSocket
            data = preloadedData;
            console.log('Using preloaded whale data from WebSocket');
        } else {
            // Fetch from API
            const response = await fetch('/api/whale-activity');
            data = await response.json();
            console.log('Whale activity data loaded from API');
        }

        // Update whale statistics in header
        const headerStats = document.querySelector('h2 > span');
        if (headerStats && data.stats) {
            headerStats.textContent = `${data.stats.volume || '25K'}VOL ${data.stats.moves || '47'}MOVES ${data.stats.hot_token || '$PEPE2HOT'}`;
        }

        // Update whale feed with real data
        const whaleFeed = document.getElementById('whale-feed');
        if (whaleFeed && data.movements) {
            whaleFeed.innerHTML = '';
            
            if (data.movements.length > 0) {
                data.movements.forEach(movement => {
                    const whaleItem = document.createElement('div');
                    whaleItem.className = `whale-item ${movement.action.toLowerCase()}`;
                    
                    whaleItem.innerHTML = `
                        <div class="col wallet">${movement.wallet || '0x000...000'}</div>
                        <div class="col action">${movement.action || 'Unknown'}</div>
                        <div class="col amount">${movement.amount || '0 SOL'}</div>
                        <div class="col impact ${movement.impact_level.toLowerCase() || 'low'}">${movement.impact_level || 'Low'}</div>
                    `;
                    
                    whaleFeed.appendChild(whaleItem);
                });
            } else {
                // Show empty state
                const emptyState = document.createElement('div');
                emptyState.className = 'whale-empty';
                emptyState.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #888;">
                        No whale activity detected
                    </div>
                `;
                whaleFeed.appendChild(emptyState);
            }
        }

        // Update pressure metrics
        if (data.metrics) {
            document.getElementById('whale-buy-pressure').textContent = data.metrics.buy_pressure || '65%';
            document.getElementById('whale-sell-pressure').textContent = data.metrics.sell_pressure || '35%';
            
            document.getElementById('buy-pressure-fill').style.width = data.metrics.buy_pressure || '65%';
            document.getElementById('sell-pressure-fill').style.width = data.metrics.sell_pressure || '35%';
        }
        
    } catch (error) {
        console.error('Error loading whale activity:', error);
        // Show error state
        const whaleFeed = document.getElementById('whale-feed');
        if (whaleFeed) {
            whaleFeed.innerHTML = `
                <div style="text-align: center; padding: 20px; color: #ff0000;">
                    Error loading whale data
                </div>
            `;
        }
    }
}

// Make function globally available
window.loadWhaleActivity = loadWhaleActivity;

document.addEventListener('DOMContentLoaded', function() {
    // Load initial data
    loadWhaleActivity();
    
    // Set up auto-refresh
    setInterval(loadWhaleActivity, 8000);
    
    // Get all filter buttons and set up filtering
    const filterButtons = document.querySelectorAll('.filter-btn');
    
    // Add click event listeners to all filter buttons
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons
            filterButtons.forEach(btn => btn.classList.remove('active'));
            
            // Add active class to clicked button
            this.classList.add('active');

            // Get the filter type from button text
            const filterType = this.textContent.toLowerCase();

            // Show/hide whale items based on filter
            const whaleItems = document.querySelectorAll('.whale-item');
            whaleItems.forEach(item => {
                if (filterType === 'all') {
                    item.style.display = 'grid';
                } else {
                    const action = item.querySelector('.action').textContent.toLowerCase();
                    if (action === filterType.slice(0, -1)) { // Remove 's' from 'buys'/'sells'/'transfers'
                        item.style.display = 'grid';
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
        });
    });
});
</script>
